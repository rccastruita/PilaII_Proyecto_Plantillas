{% extends 'base.html' %}

{% block title %}{{ product.name }} - Laura's{% endblock %}

{% block content %}

<main>
  <section class="section section-top section-split">
    <h1 class="split__title">
      {{ product.name }}
    </h1>

    {% comment %}
    Urls para editar o eliminar registros
    Solo se muestran si el usuario cuenta con los permisos necesarios.
    {% endcomment %}
    <div>
      {% if perms.shopping.change_product %}
        <a href="{% url 'product_delete' product.pk %}">Eliminar</a>
      {% endif %}
      {% if perms.shopping.change_product and perms.shopping.delete_product %} | {% endif %}
      {% if perms.shopping.delete_product %}
        <a href="{% url 'product_update' product.pk %}">Modificar</a>
      {% endif %}
    </div>

    <div class="split">
      <div class="split__column split__column--left">
        <p class="split__paragraph">{{ product.description }}</p>
        <h2 class="split__subtitle">
          Presentaciones
        </h2>
        <div class="product-presentations">
          {% for presentation in product.presentations.all %}
            <p><strong>{{ presentation.name }}</strong> - ${{ presentation.price }}</p>
          {% endfor %}
        </div>
      </div>
      {% if product.image %}
      <div class="split__column split__column--right">
        <img class="split__image" src="{{ product.image.url }}" alt="">
      </div>
      {% endif %}
    </div>
  </section>
  <section class="section section-comments">
    <h1 class="section__title">Comentarios</h1>
    {% for comment in product.comments.all %}
      <div class="comment{% if user == comment.user %} comment--clickable{% endif %}">
        <div class="comment__heading">
          <h2 class="comment__user">
            {{ comment.user.username }}
          </h2>
          <span class="comment__timestamp">{{ comment.timestamp|date:'SHORT_DATETIME_FORMAT' }}</span>
          {% if user == comment.user %}
            <span class="comment__edit">
              <a href="{% url 'comment_update' product_pk=product.pk comment_pk=comment.pk %}">
                <i class="fas fa-edit"></i>
              </a>
              <a href="{% url 'comment_delete' product_pk=product.pk comment_pk=comment.pk %}">
                <i class="fas fa-trash"></i>
              </a>
            </span>
          {% endif %}
        </div>
        <div class="comment__body">
          <p class="comment__paragraph">{{ comment.body }}</p>
        </div>
      </div>
    {% endfor %}
    <form class="form comment-form" action="{% url 'comment_create' product.pk %}" method='POST'>
      {% csrf_token %}
      {% comment %}
      Not implemented yet

      <div class="star-input-container">
        <span class="star-input__label">Calificaci√≥n:</span>
        <div class="star-input">
          <span class="star star--checked" id="star-input-1">
            <svg class="star__icon"><use href="#star-icon-sprite"></use></svg>
          </span>
          <span class="star star--checked" id="star-input-2">
            <svg class="star__icon"><use href="#star-icon-sprite"></use></svg>
          </span>
          <span class="star star--checked" id="star-input-3">
            <svg class="star__icon"><use href="#star-icon-sprite"></use></svg>
          </span>
          <span class="star" id="star-input-4">
            <svg class="star__icon"><use href="#star-icon-sprite"></use></svg>
          </span>
          <span class="star" id="star-input-5">
            <svg class="star__icon"><use href="#star-icon-sprite"></use></svg>
          </span>
        </div>
      </div>
      {% endcomment %}
      {{ comment_form.as_p }}
      <button class="btn btn--black form__submit">Enviar</button>
    </form>
  </section>
</main>

{% endblock %}